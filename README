 mysCellar - README

 Summary
 =======
 
   Description
   CAV-01 - Flooding detection
   CAV-02 - Temperature measure
   CAV-03 - Humidity measure
   CAV-04 - Door opening
   Arduino pins
   Interactions

-----------------------------------------------------------------------
 Description
 ===========

 The mysCellar sensor is an Arduino Nano-based MySensors v 2.1x sensor.

 It sends to the controller:
 - the current temperature
 - the current humidity rate
 - an alert when the door is opened or closed
 - an alert when the cellar is flooded.

 Current temperature and humidity rate are sent on a configurable period.
 Door and flooding alerts are sent as soon as they are detected.
 Door and flooding status are re-sent on a configurable period.

-----------------------------------------------------------------------
 CAV-01 - Flooding detection
 ===========================

  Composants:
  - Foliar rain sensor module sensitive sensor module (AliExpress USD 0.91)
  - Arduino Nano (AliExpress EUR 2.91 x 5)

    [1] The rain sensor detects water that completes the circuits on
        its sensor boards' printed leads. The sensor board acts as a
        variable resistor that will change from 100k ohms when wet to
        2M ohms when dry. In short, the wetter the board the more
        current that will be conducted.
    [2] Connect the 5V power supply , power indicator light , sensor 
        board does not drop when , DO output is high , the switch lights
        off , dripping a drop of water , DO output is low , the switch
        indicator light,

    Nano output:
    - VCC 5v to sensor
    - GND

    Nano input
    - logical D0 (from HIGH=dry to LOW=wet) -> D4 [D4]
    - analog A0 (from 1023=dry to 0=soak)   -> ADC7 (analog only) [A7]

[1] http://www.instructables.com/id/Arduino-Modules-Rain-Sensor/
[2] http://www.aliexpress.com/snapshot/6826183159...
    http://www.aliexpress.com/item/Free-Shipping-2sets-Foliar-rain-sensor-module-sensitive-sensor-module/1801852999.html

-----------------------------------------------------------------------
 CAV-02 - Temperature measure
 CAV-03 - Humidity measure
 ============================

  Composants:
  - DHT22 Digital For Arduino AM2302 Temperature and Humidity Sensor Module (AliExpress USD 4.48)
    One-Wire: single serial bi-directional

    Nano output:
    - VCC 5v to sensor
    - GND

    Nano input
    - one-wire single serial

[1] http://www.aliexpress.com/snapshot/6826183160.html
    http://fr.aliexpress.com/item/Free-Shipping-DHT22-Digital-For-Arduino-AM2302-Temperature-and-Humidity-Sensor-Module/32292804849.html
[2] http://www.electroschematics.com/11291/arduino-dht22-am2302-tutorial-library/

I2C Logic Level Converter Bi-Directional Module 5V to 3.3V For Arduino (AliExpress USD 1.22)

NRF24L01+ Wireless Module 2.4G Wireless Communication Module (AliExpress USD 0.67 x 10)
http://www.aliexpress.com/snapshot/6830181791.html

W5100 Ethernet module Ethernet network module for arduino (AliExpress USD 6.65)
http://fr.aliexpress.com/item/Free-shipping-W5100-Ethernet-module-Ethernet-network-module-for-arduino/2027367160.html

-----------------------------------------------------------------------
 CAV-04 - Door opening
 =====================

 The sensor is provided by the Telemecanique door switch.
 This is a double-relais platine, with a NO and a NC contacts.
 The NC contact is used by origin for lights.
 We are using here the NO contact for the door opening detector:
 - door closed : contact is closed
 - door opened: contact is opened.

 A 10k resistor is connected to get the opening detection.

-----------------------------------------------------------------------
 Arduino pins
 ============

  D1/TX:
  D0/RX:
  RST:
  GND:
  A0:               door opening detection
  D2/INT0:          radio module IRQ
  D3:       (input) temp-hygro sensor SDA output
  D4:       (input) rain sensor digital output
  D9:               radio module CE
  D10/CSN:          radio module CSN
  D11/MOSI:         radio module MOSI
  D12/MISO:         radio module MISO
  D13/SCK:          radio module SCK
  3.3V:             radio module VCC
  A7:       (input) rain sensor analog output
  5V:               rain sensor VCC
                   +temp-hygro sensor VCC
  GND:              rain sensor GND
                   +temp-hygro sensor GND
                   +radio module GND
                   +door opening detection GND
                   +alimentation GND
  VIN:       alimentation +5v

-----------------------------------------------------------------------
 Interactions
 ============

 The MySensors node present one main ID to the controller, to manage global
 actions and request or set global parameters.

 Each sensor presents its own ID.

 Below interactions are seen from MySensors node point of view.

 - CHILD_MAIN (S_CUSTOM)
   Present the node to the controller, and let us manage global actions.
    |
    +- Received from controller
    |   |
    |   +- C_SET
    |   |   |
    |   |   +- V_CUSTOM with payload = '1=<value>': set the measures max frequency (default is 1mn - ms).
    |   |   +- V_CUSTOM with payload = '2=<value>': set the unchanged timeout (default is 1h - ms).
    |   |
    |   +- C_REQ
    |       |
    |       +- V_CUSTOM with payload = '1': request a configuration dump
    |                                       send the configuration parameters along with the value of the sensors
    |
    +- Sent to controller
        |
        +- V_VAR1: measures max frequency (ms) in response to CHILD_MAIN:C_REQ:V_CUSTOM:payload=1
        +- V_VAR2: unchanged timeout (ms) in response to CHILD_MAIN:C_REQ:V_CUSTOM:payload=1

 - CHILD_FLOOD (S_WATER_LEAK)
    |
    +- Sent to controller
        |
        +- V_TRIPPED: whether a flooding is detected

 - CHILD_FLOOD_AN (S_CUSTOM)
    |
    +- Sent to controller
        |
        +- V_VAR1: (starting with 5.2) humidity rate from 0 (flood) to 1024 (dry)

 - CHILD_TEMPERATURE (S_TEMP)
    |
    +- Sent to controller
        |
        +- V_TEMP: temperature (Â°C)

 - CHILD_HUMIDITY (S_HUM)
    |
    +- Sent to controller
        |
        +- V_HUM: humidity (%)

 - CHILD_OPENING (S_DOOR)
    |
    +- Sent to controller
        |
        +- V_TRIPPED: whether the door is opened (or closed)

-----------------------------------------------------------------------
 P. Wieser - Created on 2017, may 2nd.
             Last updated on 2017, may, 12th

